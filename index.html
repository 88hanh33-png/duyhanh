<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Ghi S·ªï Ti·∫øt D·∫°y - WebApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>

/* ========== FORM LOGIN M·ªöI ========== */
#login-form {
  background: white;
  border-radius: 16px;
  padding: 40px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 450px;
  margin: 0 auto;
  text-align: center;
  border: 1px solid #e0e0e0;
}

#login-form h2 {
  color: #27ae60;
  margin-bottom: 25px;
  font-size: 1.8rem;
  position: relative;
  padding-bottom: 15px;
}

#login-form h2::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 3px;
  background: #27ae60;
  border-radius: 3px;
}

#login-form input[type="text"],
#login-form input[type="password"] {
  padding: 14px 20px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 1rem;
  transition: all 0.3s;
  margin-bottom: 15px;
  width: 100%; /* C·∫≠p nh·∫≠t */
}

#login-form input[type="text"]:focus,
#login-form input[type="password"]:focus {
  border-color: #27ae60;
  box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
}

#login-form label {
  display: flex;
  align-items: center;
  margin: 10px 0;
  cursor: pointer;
  font-size: 0.95rem;
  color: #555;
}

#login-form button[type="submit"] {
  background: #27ae60;
  color: white;
  border: none;
  padding: 14px;
  border-radius: 10px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 20px;
  width: 100%;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

#login-form button[type="submit"]:hover {
  background: #219653;
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

#login-form button[type="submit"]:active {
  transform: translateY(0);
}

.login-options {
  display: flex;
  justify-content: space-between;
  margin-top: 15px;
  flex-wrap: wrap;
}

.login-footer {
  margin-top: 25px;
  color: #777;
  font-size: 0.9rem;
}



/* Responsive */
@media (max-width: 480px) {
  #login-form {
    padding: 30px 20px;
  }
  
  .login-options {
    flex-direction: column;
    gap: 10px;
  }
}
  /* Reset c∆° b·∫£n */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f6f8;
    color: #333;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    background: #27ae60;
    color: white;
    padding: 16px 24px;
    font-size: 1.2rem;
    font-weight: 700;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; /* Th√™m ƒë·ªÉ header c√≥ th·ªÉ xu·ªëng d√≤ng */
    gap: 10px; /* Th√™m kho·∫£ng c√°ch gi·ªØa c√°c item */
  }
  header .actions button {
    background: #1e8449;
    border: none;
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.25s ease;
  }
  header .actions button:hover {
    background-color: #145a32;
  }

/* ========== THI·∫æT K·∫æ CHO KHU V·ª∞C HI·ªÇN TH·ªä T√äN GI√ÅO VI√äN ========== */
header .actions {
  display: flex;
  align-items: center; /* CƒÉn gi·ªØa c√°c m·ª•c theo chi·ªÅu d·ªçc */
  gap: 12px; /* Th√™m kho·∫£ng c√°ch gi·ªØa c√°c m·ª•c */
}

#teacher-display {
    display: flex; /* S·ª≠ d·ª•ng flex ƒë·ªÉ cƒÉn icon v√† ch·ªØ */
    align-items: center;
    gap: 8px; /* Kho·∫£ng c√°ch gi·ªØa icon v√† t√™n */
    background-color: rgba(255, 255, 255, 0.2); /* M√†u n·ªÅn h∆°i trong su·ªët */
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.95rem;
    border: 1px solid rgba(255, 255, 255, 0.5); /* Vi·ªÅn m·ªù */
}

#teacher-display .fa-user-check {
    font-size: 1.1em; /* K√≠ch th∆∞·ªõc icon */
}

  main {
    flex-grow: 1;
    max-width: 600px;
    margin: 24px auto;
    background: white;
    padding: 24px 32px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgb(0 0 0 / 0.1);
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  h2 {
    margin-top: 0;
    color: #27ae60;
    text-align: center;
    font-weight: 700;
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  input[type="text"],
  input[type="password"],
  input[type="date"],
  input[type="datetime-local"],
  select {
    width: 100%;
    padding: 10px 12px;
    border: 1.8px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus,
  input[type="password"]:focus,
  input[type="date"]:focus,
  input[type="datetime-local"]:focus,
  select:focus {
    border-color: #27ae60;
    outline: none;
  }

  /* Thay ƒë·ªïi ƒë·ªÉ hi·ªÉn th·ªã tr∆∞·ªùng b·ªã kh√≥a */
  input[readonly] {
    background-color: #eeeeee; /* M√†u n·ªÅn x√°m h∆°n */
    cursor: not-allowed;   /* Con tr·ªè kh√¥ng cho ph√©p */
  }


  label {
    font-weight: 600;
    margin-bottom: 4px;
  }
  .row {
    display: flex;
    gap: 20px;
  }
  .row > div {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .row-datetime-location {
    display: flex;
    gap: 20px;
  }
  .row-datetime-location > div {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .note {
    margin-top: 4px;
    font-size: 0.85rem;
    color: #666;
  }

  button[type="submit"] {
    margin-top: 10px;
    padding: 12px 0;
    background: #27ae60;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.1rem;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button[type="submit"]:hover {
    background: #219150;
  }

  #login-error {
    color: #e74c3c;
    font-weight: 600;
    min-height: 1.2em;
  }

  /* Checkbox inline label */
  label > input[type="checkbox"] {
    margin-right: 6px;
    transform: scale(1.15);
    vertical-align: middle;
  }

/* ========== GIAO DI·ªÜN L·ªäCH S·ª¨ M·ªöI ========== */
#history-popup {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 5500;
    padding: 16px;
}
.history-panel {
    background: white;
    border-radius: 12px;
    width: 95%;
    max-width: 500px; /* Thu nh·ªè l·∫°i cho giao di·ªán d·ªçc */
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 30px rgb(0 0 0 / 0.25);
}
.history-head {
    padding: 18px 24px;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.history-head h3 {
    margin: 0;
    font-weight: 700;
    color: #27ae60;
}
.close-history {
    background: transparent;
    border: none;
    font-size: 28px;
    line-height: 1;
    cursor: pointer;
    color: #555;
    transition: color 0.3s ease;
}
.close-history:hover {
    color: #e74c3c;
}
.history-filters {
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid #ddd;
    font-weight: 600;
    font-size: 0.9rem;
    flex-wrap: nowrap; /* T·∫Øt t√≠nh nƒÉng xu·ªëng d√≤ng ƒë·ªÉ gi·ªØ tr√™n m·ªôt h√†ng */
    overflow-x: auto;
}

.history-filters label {
    flex-shrink: 0;
    white-space: nowrap;
}

#history-date {
    flex-grow: 1;
    padding: 8px 12px;
    font-size: 0.95rem;
}

#history-search {
    flex-shrink: 0;
    padding: 8px 18px;
    border: none;
    background: #27ae60;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    display: flex; /* B·∫≠t flexbox cho n√∫t */
    align-items: center;
    gap: 8px; /* Kho·∫£ng c√°ch gi·ªØa icon v√† ch·ªØ */
    transition: background-color 0.3s ease;
}
#history-search:hover {
    background: #1e8449;
}

/* ·∫®n ch·ªØ "T√¨m ki·∫øm" tr√™n m√†n h√¨nh nh·ªè */
@media (max-width: 480px) {
  #history-search .search-text {
    display: none;
  }
  #history-search {
    padding: 10px; /* ƒêi·ªÅu ch·ªânh padding cho n√∫t ch·ªâ c√≥ icon */
  }
  #history-search .fas {
    font-size: 1.1rem; /* TƒÉng k√≠ch th∆∞·ªõc icon */
  }
}
}
#history-search:hover {
    background: #1e8449;
}

#history-body {
    padding: 20px 24px;
    overflow-y: auto;
    flex-grow: 1;
}

#history-record-display .field-group {
    margin-bottom: 12px;
}
#history-record-display label {
    display: block;
    font-size: 0.8rem;
    color: #666;
    margin-bottom: 2px;
    font-weight: 600;
}
/* Style cho d·ªØ li·ªáu hi·ªÉn th·ªã gi·ªëng input */
#history-record-display .data, 
#history-record-display input, 
#history-record-display select {
    width: 100%;
    padding: 10px 12px;
    border: 1.8px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    background-color: #f4f4f4;
}

#history-record-display input, #history-record-display select {
    background-color: #fff; /* N·ªÅn tr·∫Øng khi ch·ªânh s·ª≠a */
}


#history-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

#history-navigation button {
    padding: 8px 20px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid #27ae60;
    background-color: white;
    color: #27ae60;
    border-radius: 6px;
    transition: all 0.2s ease;
}
#history-navigation button:hover {
    background-color: #27ae60;
    color: white;
}
#history-navigation button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: #e0e0e0;
    border-color: #e0e0e0;
    color: #999;
}
#history-counter {
    font-weight: 600;
    color: #333;
}

#history-actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
#history-actions button {
    flex: 1;
    padding: 10px;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}
.btn-edit {
    background: #f39c12;
}
.btn-update {
    background: #27ae60;
}
.btn-delete {
    background: #e74c3c;
}
.btn-cancel {
    background: #95a5a6;
}

/* ·∫®n/hi·ªán c√°c n√∫t t√πy theo mode */
.view-mode .edit-controls,
.edit-mode .view-controls {
    display: none;
}


  /* Loading overlay */
  #loading-overlay {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.3);
    justify-content: center;
    align-items: center;
    z-index: 6000;
  }
  .spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #27ae60;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% {transform: rotate(0deg);}
    100% {transform: rotate(360deg);}
  }

  /* Popup message */
  #popup-message {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #27ae60;
    color: white;
    padding: 14px 26px;
    border-radius: 14px;
    font-weight: 600;
    box-shadow: 0 4px 14px rgb(0 0 0 / 0.3);
    z-index: 6001;
    min-width: 240px;
    text-align: center;
    user-select: none;
  }
  #popup-message.error {
    background: #e74c3c;
  }
  #popup-message .popup-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}
#popup-text {
    flex: 1; /* cho n·ªôi dung t·ª± co l·∫°i v√† kh√¥ng b·ªã n√∫t X ƒë√® */
}
#popup-close {
    flex-shrink: 0;
    background: transparent;
    border: none;
    color: white;
    font-size: 22px;
    cursor: pointer;
}


  /* Responsive */
  @media (max-width: 480px) {
    main {
      margin: 16px;
      padding: 16px;
    }
    .row, .row-datetime-location {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<header>
  <div>üìö Tr∆∞·ªùng PTDTBT THCS Thu C√∫c</div>
  <div class="actions">
    <div id="teacher-display" style="display:none;"></div>
    <button id="history-btn" style="display:none;">üìú L·ªãch s·ª≠</button>
    <button id="logout-btn" style="display:none;">ƒêƒÉng xu·∫•t</button>
  </div>
</header>

<main>

  <form id="login-form" onsubmit="event.preventDefault(); login();" novalidate>
  <h2>ƒêƒÉng Nh·∫≠p H·ªá Th·ªëng</h2>
  
  <input type="text" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" autocomplete="username" required />
  
  <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" autocomplete="current-password" required />
  
  <div class="login-options">
    <label><input type="checkbox" id="remember-me" /> Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
    <label><input type="checkbox" id="show-password" /> Hi·ªÉn th·ªã m·∫≠t kh·∫©u</label>
  </div>
  
  <button type="submit">
    <i class="fas fa-sign-in-alt"></i> ƒêƒÉng Nh·∫≠p
  </button>
  
  <div class="login-footer">
    H·ªá th·ªëng qu·∫£n l√Ω ti·∫øt d·∫°y <br >Tr∆∞·ªùng PTDTBT THCS Thu C√∫c
  </div>
  
  <div id="login-error" aria-live="polite"></div>
</form>

  <form id="record-form" onsubmit="event.preventDefault(); submitForm();" style="display:none;" novalidate>
    <h2>Ghi S·ªï Ti·∫øt D·∫°y</h2>

    <div class="row">
      <div>
        <label for="khoi">Ch·ªçn kh·ªëi</label>
        <select id="khoi" required>
          <option value="">-- Ch·ªçn kh·ªëi --</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
        </select>
      </div>

      <div>
        <label for="sheet">Ch·ªçn l·ªõp</label>
        <select id="sheet" required>
          <option value="">-- Ch·ªçn l·ªõp --</option>
        </select>
      </div>
    </div>

    <label for="lesson">Ti·∫øt</label>
    <input type="text" id="lesson" placeholder="Nh·∫≠p ti·∫øt" required />

    <label for="title">T√™n b√†i</label>
    <input type="text" id="title" placeholder="Nh·∫≠p t√™n b√†i" required />
	
<label for="comment">Nh·∫≠n x√©t</label>
<input type="text" id="comment" placeholder="Nh·∫≠n x√©t c·ªßa b·∫°n" />

<label for="rating">ƒê√°nh gi√°</label>
<select id="rating" required>
  <option value="">-- Ch·ªçn ƒë√°nh gi√° --</option>
  <option value="T·ªët">T·ªët</option>
  <option value="Kh√°">Kh√°</option>
  <option value="ƒê·∫°t">ƒê·∫°t</option>
  <option value="Kh√¥ng ƒë·∫°t">Kh√¥ng ƒë·∫°t</option>
</select>
    <div class="row-datetime-location">
      <div>
        <label for="datetime-input">Ng√†y &amp; Gi·ªù</label>
        <input type="datetime-local" id="datetime-input" required />
      </div>

      <div>
        <label>V·ªã tr√≠</label>
        <input type="text" id="location" readonly />
      </div>
    </div>

    <button type="submit" class="submit-btn">G·ª≠i</button>
  </form>

</main>

<div id="history-popup" role="dialog" aria-modal="true" aria-labelledby="history-title" tabindex="-1">
  <div class="history-panel" role="document">
    <div class="history-head">
      <h3 id="history-title">L·ªãch s·ª≠ Ghi S·ªï</h3>
      <button class="close-history" id="close-history" title="ƒê√≥ng">&times;</button>
    </div>

    <div class="history-filters">
      <label for="history-date">Ch·ªçn ng√†y:</label>
      <input type="date" id="history-date" />
   <button id="history-search">
  <i class="fas fa-search"></i>
  <span class="search-text">T√¨m ki·∫øm</span>
</button>
    </div>

    <div id="history-body">
        <div id="history-record-display" class="view-mode">
            </div>

        <div id="history-navigation" style="display:none;">
            <button id="history-prev-btn">&lt; Tr∆∞·ªõc</button>
            <span id="history-counter"></span>
            <button id="history-next-btn">Sau &gt;</button>
        </div>

        <div id="history-actions" style="display:none;">
            <div class="view-controls" style="display: flex; gap: 10px; width: 100%; flex-wrap: wrap;">
                <button id="history-edit-btn" class="btn-edit">S·ª≠a</button>
                <button id="history-delete-btn" class="btn-delete">X√≥a</button>
            </div>
             <div class="edit-controls" style="display: flex; gap: 10px; width: 100%; flex-wrap: wrap;">
                <button id="history-update-btn" class="btn-update">C·∫≠p nh·∫≠t</button>
                <button id="history-cancel-btn" class="btn-cancel">H·ªßy</button>
            </div>
        </div>
    </div>

  </div>
</div>

<div id="loading-overlay" role="status" aria-live="polite" aria-label="ƒêang x·ª≠ l√Ω">
  <div class="spinner"></div>
</div>

<div id="popup-message" role="alert" aria-live="assertive" style="display:none;">
  <div class="popup-content">
    <span id="popup-text"></span>
    <button id="popup-close" aria-label="ƒê√≥ng th√¥ng b√°o">&times;</button>
  </div>
</div>

<script>


let startY = 0;
    const refreshThreshold = 80; // Kho·∫£ng c√°ch k√©o t·ªëi thi·ªÉu ƒë·ªÉ l√†m m·ªõi (t√≠nh b·∫±ng pixel)

    document.addEventListener('touchstart', (e) => {
        // Ch·ªâ k√≠ch ho·∫°t khi k√©o t·ª´ ƒë·∫ßu trang
        if (window.scrollY === 0) {
            startY = e.touches[0].clientY;
        }
    });

    document.addEventListener('touchmove', (e) => {
        if (startY === 0) return;

        const currentY = e.touches[0].clientY;
        const pullDistance = currentY - startY;
        
        // NgƒÉn ch·∫∑n cu·ªôn trang n·∫øu ƒëang k√©o xu·ªëng
        if (pullDistance > 0 && window.scrollY === 0) {
            e.preventDefault();
        }
    });

    document.addEventListener('touchend', (e) => {
        if (startY === 0) return;

        const currentY = e.changedTouches[0].clientY;
        const pullDistance = currentY - startY;

        // N·∫øu k√©o ƒë·ªß kho·∫£ng c√°ch, t·∫£i l·∫°i trang
        if (window.scrollY === 0 && pullDistance > refreshThreshold) {
            window.location.reload();
        }
        
        startY = 0;
    });




	
// Th√™m hi·ªáu ·ª©ng khi nh·∫•p v√†o input
document.querySelectorAll('#login-form input').forEach(input => {
  input.addEventListener('focus', function() {
    this.parentNode.querySelector('label')?.classList.add('active');
  });
  
  input.addEventListener('blur', function() {
    if (!this.value) {
      this.parentNode.querySelector('label')?.classList.remove('active');
    }
  });
});

// Hi·ªÉn th·ªã m·∫≠t kh·∫©u
document.getElementById('show-password').addEventListener('change', function() {
  const pwd = document.getElementById('password');
  pwd.type = this.checked ? 'text' : 'password';
});
// H√†m hi·ªÉn th·ªã popup ch√†o/t·∫°m bi·ªát

const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzRXxmGjEd-52EvdsYt2WZJYulMFfzEaGT5xY0x1sGhyXJRFxbtCOdD_8bZDxG8VNJq1Q/exec"; 
// => THAY b·∫±ng URL WebApp do b·∫°n deploy (Apps Script)

const lopTheoKhoi = {
  "6": ["6A","6B","6C","6D","6E"],
  "7": ["7A","7B","7C","7D","7E"],
  "8": ["8A","8B","8C","8D","8E"],
  "9": ["9A","9B","9C","9D"]
};

// State variables cho L·ªãch s·ª≠
let historyRecords = [];
let currentHistoryIndex = 0;

const loginForm = document.getElementById("login-form");
const recordForm = document.getElementById("record-form");
const logoutBtn = document.getElementById("logout-btn");
const historyBtn = document.getElementById("history-btn");
const teacherDisplay = document.getElementById("teacher-display");

const loadingOverlay = document.getElementById("loading-overlay");
const popupMessage = document.getElementById("popup-message");
const popupText = document.getElementById("popup-text");
const popupCloseBtn = document.getElementById("popup-close");

const khoiSelect = document.getElementById("khoi");
const sheetSelect = document.getElementById("sheet");
const datetimeInput = document.getElementById("datetime-input");
const locationInput = document.getElementById("location");

// C√°c element c·ªßa Popup L·ªãch s·ª≠
const historyPopup = document.getElementById("history-popup");
const closeHistory = document.getElementById("close-history");
const historySearchBtn = document.getElementById("history-search");
const historyDateInput = document.getElementById("history-date");
const historyBody = document.getElementById("history-body");
const historyRecordDisplay = document.getElementById("history-record-display");
const historyNavigation = document.getElementById("history-navigation");
const historyCounter = document.getElementById("history-counter");
const historyPrevBtn = document.getElementById("history-prev-btn");
const historyNextBtn = document.getElementById("history-next-btn");
const historyActions = document.getElementById("history-actions");

const historyEditBtn = document.getElementById("history-edit-btn");
const historyDeleteBtn = document.getElementById("history-delete-btn");
const historyUpdateBtn = document.getElementById("history-update-btn");
const historyCancelBtn = document.getElementById("history-cancel-btn");


// C·∫≠p nh·∫≠t l·ª±a ch·ªçn l·ªõp theo kh·ªëi
khoiSelect.addEventListener("change", () => {
  const khoi = khoiSelect.value;
  sheetSelect.innerHTML = '<option value="">-- Ch·ªçn l·ªõp --</option>';
  if (khoi && lopTheoKhoi[khoi]) {
    lopTheoKhoi[khoi].forEach(lop => {
      const option = document.createElement("option");
      option.value = lop;
      option.textContent = lop;
      sheetSelect.appendChild(option);
    });
  }
});

// C·∫≠p nh·∫≠t datetime v√† location
function updateDatetimeLocation() {
  const now = new Date();
  // ƒê·ªãnh d·∫°ng gi√° tr·ªã cho datetime-local: yyyy-MM-ddThh:mm
  function pad(n){return n<10?'0'+n:n;}
  const yyyy = now.getFullYear();
  const MM = pad(now.getMonth()+1);
  const dd = pad(now.getDate());
  const hh = pad(now.getHours());
  const mm = pad(now.getMinutes());
  datetimeInput.value = `${yyyy}-${MM}-${dd}T${hh}:${mm}`;

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        locationInput.value = pos.coords.latitude.toFixed(5) + ", " + pos.coords.longitude.toFixed(5);
      },
      () => {
        locationInput.value = "Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠";
      },
      {timeout:10000}
    );
  } else {
    locationInput.value = "Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS";
  }
}

// Kh·ªüi ƒë·ªông l√∫c t·∫£i trang
window.addEventListener("DOMContentLoaded", () => {
  const savedUsername = localStorage.getItem("savedUsername");
  if (savedUsername) showRecordForm(savedUsername);
  updateDatetimeLocation();
});

// Loading / Popup helpers
function showLoading(){ loadingOverlay.style.display = "flex"; }
function hideLoading(){ loadingOverlay.style.display = "none"; }
function showPopup(msg, isError=false){
  popupText.textContent = msg;
  if(isError) {
    popupMessage.classList.add('error');
  } else {
    popupMessage.classList.remove('error');
  }
  popupMessage.style.display = "block";
  // T·ª± ƒë·ªông ·∫©n n·∫øu KH√îNG ph·∫£i l√† l·ªói
  if(!isError) { 
      clearTimeout(popupMessage.timeoutId);
      popupMessage.timeoutId = setTimeout(() => { popupMessage.style.display = "none"; }, 4500);
  } else {
      // N·∫øu l√† l·ªói, kh√¥ng t·ª± ƒë·ªông ·∫©n, ch·ªâ c·∫ßn ƒë·∫£m b·∫£o popup ƒëang hi·ªÉn th·ªã
      clearTimeout(popupMessage.timeoutId); // X√≥a timeout c≈© n·∫øu c√≥
  }
}
popupCloseBtn.addEventListener("click", () => { popupMessage.style.display = "none"; clearTimeout(popupMessage.timeoutId); });

// Login
function login(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const remember = document.getElementById("remember-me").checked;
  document.getElementById("login-error").textContent = "";

  if(!username || !password){
    document.getElementById("login-error").textContent = "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß";
    return;
  }

  showLoading();
  fetch(WEBAPP_URL, {
    method:"POST",
    body: JSON.stringify({ action:"login", username, password }),
  })
    .then(r => r.json())
    .then(data => {
      hideLoading();
      if(data.success){
        showRecordForm(data.teacher || username);
        if(remember) localStorage.setItem("savedUsername", username);
        else localStorage.removeItem("savedUsername");
        
        showGreeting('welcome', data.teacher || username);
      } else {
        document.getElementById("login-error").textContent = data.message || "ƒêƒÉng nh·∫≠p th·∫•t b·∫°i";
      }
    })
    .catch(err => {
      hideLoading();
      document.getElementById("login-error").textContent = "L·ªói: "+err.message;
    });
}
function showRecordForm(username){
  loginForm.style.display = "none";
  recordForm.style.display = "flex";
  logoutBtn.style.display = "inline-block";
  historyBtn.style.display = "inline-block";
  
  teacherDisplay.innerHTML = `<i class="fas fa-user-check"></i> ${escapeHtml(username)}`;
  teacherDisplay.dataset.teacherName = username; 
  teacherDisplay.style.display = "flex";

  if (!document.getElementById("username").value) {
    showGreeting('welcome', username);
  }
}

function showLoginForm(){
  loginForm.style.display = "block";
  recordForm.style.display = "none";
  logoutBtn.style.display = "none";
  historyBtn.style.display = "none";
  
  teacherDisplay.style.display = "none";
  teacherDisplay.innerHTML = "";
  delete teacherDisplay.dataset.teacherName;

  document.getElementById("username").value="";
  document.getElementById("password").value="";
  document.getElementById("remember-me").checked = false;
}

document.getElementById("show-password").addEventListener("change", function(){
  const pwd = document.getElementById("password");
  pwd.type = this.checked ? "text" : "password";
});
logoutBtn.addEventListener("click", ()=>{
  const username = teacherDisplay.dataset.teacherName || '';
  
  showGreeting('goodbye', username);
  
  setTimeout(() => {
    localStorage.removeItem("savedUsername");
    showLoginForm();
  }, 1000);
});
function showGreeting(type, username) {
  const popup = document.getElementById('greeting-popup');
  const text = document.getElementById('greeting-text');
  const subtext = document.getElementById('greeting-subtext');
  
  const now = new Date();
  const hour = now.getHours(); // L·∫•y gi·ªù hi·ªán t·∫°i
  
  if(type === 'welcome') {
    let greeting, motivation;
    
    // Logic m·ªõi, d·ªÖ ki·ªÉm tra h∆°n
    if (hour >= 5 && hour < 12) {
      greeting = "Ch√†o bu·ªïi s√°ng!";
      motivation = "Ch√∫c b·∫°n m·ªôt ng√†y m·ªõi tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng v√† hi·ªáu qu·∫£. B·∫Øt ƒë·∫ßu ghi s·ªï th√¥i n√†o!";
    } else if (hour >= 12 && hour < 18) {
      greeting = "Ch√†o bu·ªïi chi·ªÅu!";
      motivation = "Hy v·ªçng b·∫°n c√≥ m·ªôt bu·ªïi chi·ªÅu l√†m vi·ªác th·∫≠t th√†nh c√¥ng. Ti·∫øp t·ª•c ghi l·∫°i nh·ªØng ti·∫øt d·∫°y tuy·ªát v·ªùi c·ªßa b·∫°n nh√©!";
    } else if (hour >= 18 && hour < 22) {
      greeting = "Ch√†o bu·ªïi t·ªëi!";
      motivation = "Th·∫≠t tuy·ªát v·ªùi v√¨ b·∫°n ƒë√£ quay tr·ªü l·∫°i. H√£y ghi l·∫°i nh·ªØng ti·∫øt h·ªçc cu·ªëi ng√†y ƒë·ªÉ c√≥ m·ªôt bu·ªïi t·ªëi th·∫≠t th·∫£nh th∆°i!";
    } else { // t·ª´ 22h00 ƒë·∫øn 04h59 s√°ng
      greeting = "Ch√∫c ng·ªß ngon!";
      motivation = "B·∫°n l√†m vi·ªác mu·ªôn qu√° r·ªìi ƒë·∫•y. H√£y ghi l·∫°i nh·ªØng g√¨ c·∫ßn thi·∫øt v√† ngh·ªâ ng∆°i s·ªõm nh√©!";
    }
    
    text.textContent = `Xin ch√†o, ${username}!`;
    subtext.textContent = motivation;
  } else {
    text.textContent = `T·∫°m bi·ªát, ${username}!`;
    subtext.textContent = "H·ªá th·ªëng ƒë√£ s·∫µn s√†ng cho l·∫ßn ƒëƒÉng nh·∫≠p ti·∫øp theo c·ªßa b·∫°n. H·∫πn g·∫∑p l·∫°i!";
  }
  
  popup.style.display = 'block';
  
  setTimeout(() => {
    popup.style.animation = 'fadeOut 0.9s ease-out';
    setTimeout(() => {
      popup.style.display = 'none';
      popup.style.animation = 'fadeIn 0.9s ease-out';
    }, 600);
  }, 4000);
}
// Submit form ghi s·ªï
function submitForm(){
  const teacher = teacherDisplay.dataset.teacherName || '';
  const lesson = document.getElementById("lesson").value.trim();
  const title = document.getElementById("title").value.trim();
  const comment = document.getElementById("comment").value.trim();
  const rating = document.getElementById("rating").value;
  const sheetName = document.getElementById("sheet").value;
  const datetimeVal = datetimeInput.value;

  if(!teacher){ showPopup("L·ªói phi√™n ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.", true); return; }
  if(!lesson){ showPopup("Vui l√≤ng nh·∫≠p Ti·∫øt", true); return; }
  if(!title){ showPopup("Vui l√≤ng nh·∫≠p T√™n b√†i", true); return; }
  if(!rating){ showPopup("Vui l√≤ng ch·ªçn ƒê√°nh gi√°", true); return; }
  if(!sheetName){ showPopup("Vui l√≤ng ch·ªçn L·ªõp", true); return; }
  if(!datetimeVal){ showPopup("Vui l√≤ng ch·ªçn Ng√†y & Gi·ªù", true); return; }

  const dt = new Date(datetimeVal);
  if(isNaN(dt)) {
    showPopup("Ng√†y & gi·ªù kh√¥ng h·ª£p l·ªá", true);
    return;
  }
  function pad(n){return n<10?'0'+n:n;}
  const dateStr = pad(dt.getDate()) + '/' + pad(dt.getMonth()+1) + '/' + dt.getFullYear();
  const timeStr = pad(dt.getHours()) + ':' + pad(dt.getMinutes()) + ':00';

  const data = {
  action:"submit",
  sheetName,
  teacher,
  lesson,
  title,
  comment,
  rating,
  datetime: dateStr + ' ' + timeStr,
  location: locationInput.value
};
  showLoading();
  fetch(WEBAPP_URL, { method:"POST", body: JSON.stringify(data) })
    .then(r => r.json())
    .then(res => {
      hideLoading();
      if(res.success){
        showPopup(res.message || "Ghi th√†nh c√¥ng");
        updateDatetimeLocation();
      } else {
        showPopup("L·ªói: "+(res.message||"Kh√¥ng r√µ"), true);
      }
    })
    .catch(err => {
      hideLoading();
      showPopup("L·ªói k·∫øt n·ªëi: "+err.message, true);
    });
}

// ===============================================
// ===== LOGIC M·ªöI CHO GIAO DI·ªÜN L·ªäCH S·ª¨ =====
// ===============================================

// M·ªü popup
historyBtn.addEventListener("click", () => {
  historyPopup.style.display = "flex";
  historyDateInput.valueAsDate = new Date(); // M·∫∑c ƒë·ªãnh l√† ng√†y h√¥m nay
  historyRecordDisplay.innerHTML = '<div style="text-align:center; color:#888;">Vui l√≤ng ch·ªçn ng√†y v√† nh·∫•n "T√¨m ki·∫øm".</div>';
  historyNavigation.style.display = 'none';
  historyActions.style.display = 'none';
  historyPopup.focus();
});

// ƒê√≥ng popup
closeHistory.addEventListener("click", () => {
  historyPopup.style.display = "none";
});

// T√¨m ki·∫øm
historySearchBtn.addEventListener("click", () => {
  const dateVal = historyDateInput.value;
  if(!dateVal){ showPopup("Vui l√≤ng ch·ªçn ng√†y ƒë·ªÉ t√¨m", true); return; }
  const parts = dateVal.split("-");
  const ddmmy = parts[2] + "/" + parts[1] + "/" + parts[0];
  const teacher = teacherDisplay.dataset.teacherName || '';
  const payload = { action:"searchByDate", teacher, date: ddmmy, limit: 500 };
  
  showLoading();
  fetch(WEBAPP_URL, { method:"POST", body: JSON.stringify(payload) })
    .then(r => r.json())
    .then(res => {
      hideLoading();
      if(res.success){
        historyRecords = res.records || [];
        currentHistoryIndex = 0;
        displayCurrentHistoryRecord();
      } else {
        showPopup("L·ªói: "+(res.message||"Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu"), true);
        historyRecords = [];
        displayCurrentHistoryRecord();
      }
    })
    .catch(err => {
      hideLoading();
      showPopup("L·ªói k·∫øt n·ªëi: "+err.message, true);
      historyRecords = [];
      displayCurrentHistoryRecord();
    });
});

// Hi·ªÉn th·ªã b·∫£n ghi hi·ªán t·∫°i
function displayCurrentHistoryRecord(mode = 'view') {
  if (historyRecords.length === 0) {
    historyRecordDisplay.innerHTML = '<div style="text-align:center; color:#888;">Kh√¥ng c√≥ b·∫£n ghi n√†o cho ng√†y ƒë√£ ch·ªçn.</div>';
    historyNavigation.style.display = 'none';
    historyActions.style.display = 'none';
    return;
  }

  const record = historyRecords[currentHistoryIndex];
  
  let content = '';
  if (mode === 'view') {
     content = `
        <div class="field-group"><label>Ng√†y & Gi·ªù</label><div class="data">${escapeHtml(record.date)} ${escapeHtml(record.time || '')}</div></div>
        <div class="field-group"><label>T√™n gi√°o vi√™n</label><div class="data">${escapeHtml(record.teacher)}</div></div>
		<div class="field-group"><label>L·ªõp</label><div class="data">${escapeHtml(record.sheetName)}</div></div>
        <div class="field-group"><label>Ti·∫øt</label><div class="data">${escapeHtml(record.lesson)}</div></div>
        <div class="field-group"><label>T√™n b√†i</label><div class="data">${escapeHtml(record.title)}</div></div>
        <div class="field-group"><label>Nh·∫≠n x√©t</label><div class="data">${escapeHtml(record.comment)}</div></div>
        <div class="field-group"><label>ƒê√°nh gi√°</label><div class="data">${escapeHtml(record.rating)}</div></div>
    `;
    historyRecordDisplay.className = 'view-mode';
  } else { // 'edit' mode
     content = `
        <div class="field-group"><label>Ng√†y & Gi·ªù</label><div class="data">${escapeHtml(record.date)} ${escapeHtml(record.time || '')}</div></div>
        <div class="field-group"><label>T√™n gi√°o vi√™n</label><div class="data">${escapeHtml(record.teacher)}</div></div>
		 <div class="field-group"><label>L·ªõp</label><div class="data">${escapeHtml(record.sheetName)}</div></div>
        <div class="field-group"><label>Ti·∫øt</label><input id="history-edit-lesson" type="text" value="${escapeAttr(record.lesson)}"></div>
        <div class="field-group"><label>T√™n b√†i</label><input id="history-edit-title" type="text" value="${escapeAttr(record.title)}"></div>
        <div class="field-group"><label>Nh·∫≠n x√©t</label><input id="history-edit-comment" type="text" value="${escapeAttr(record.comment)}"></div>
        <div class="field-group"><label>ƒê√°nh gi√°</label>
            <select id="history-edit-rating">
                <option value="T·ªët" ${record.rating === 'T·ªët' ? 'selected' : ''}>T·ªët</option>
                <option value="Kh√°" ${record.rating === 'Kh√°' ? 'selected' : ''}>Kh√°</option>
                <option value="ƒê·∫°t" ${record.rating === 'ƒê·∫°t' ? 'selected' : ''}>ƒê·∫°t</option>
                <option value="Kh√¥ng ƒë·∫°t" ${record.rating === 'Kh√¥ng ƒë·∫°t' ? 'selected' : ''}>Kh√¥ng ƒë·∫°t</option>
            </select>
        </div>
    `;
    historyRecordDisplay.className = 'edit-mode';
  }
  historyRecordDisplay.innerHTML = content;

  // C·∫≠p nh·∫≠t ƒëi·ªÅu h∆∞·ªõng
  historyNavigation.style.display = 'flex';
  historyActions.style.display = 'flex';
  historyCounter.textContent = `B·∫£n ghi ${currentHistoryIndex + 1} / ${historyRecords.length}`;
  historyPrevBtn.disabled = (currentHistoryIndex === 0);
  historyNextBtn.disabled = (currentHistoryIndex >= historyRecords.length - 1);
}

// N√∫t ƒëi·ªÅu h∆∞·ªõng
historyPrevBtn.addEventListener("click", () => {
    if(currentHistoryIndex > 0) {
        currentHistoryIndex--;
        displayCurrentHistoryRecord();
    }
});

historyNextBtn.addEventListener("click", () => {
    if(currentHistoryIndex < historyRecords.length - 1) {
        currentHistoryIndex++;
        displayCurrentHistoryRecord();
    }
});

// N√∫t h√†nh ƒë·ªông
historyEditBtn.addEventListener("click", () => {
    displayCurrentHistoryRecord('edit');
});

historyCancelBtn.addEventListener("click", () => {
    displayCurrentHistoryRecord('view');
});

historyDeleteBtn.addEventListener("click", () => {
    if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·∫£n ghi n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.")) return;

    const record = historyRecords[currentHistoryIndex];
    const payload = { action:"deleteRecord", sheetName: record.sheetName, rowIndex: record.rowIndex, teacher: record.teacher };
    
    showLoading();
    fetch(WEBAPP_URL, { method:"POST", body: JSON.stringify(payload) })
    .then(r => r.json())
    .then(res => {
        hideLoading();
        if(res.success){
            showPopup(res.message || "X√≥a th√†nh c√¥ng");
            historyRecords.splice(currentHistoryIndex, 1); // X√≥a kh·ªèi m·∫£ng local
            if (currentHistoryIndex >= historyRecords.length && historyRecords.length > 0) {
                currentHistoryIndex = historyRecords.length - 1; // L√πi l·∫°i n·∫øu x√≥a item cu·ªëi
            }
            displayCurrentHistoryRecord(); // Hi·ªÉn th·ªã l·∫°i
        } else {
            showPopup("L·ªói: "+(res.message||"X√≥a th·∫•t b·∫°i"), true);
        }
    })
    .catch(err => {
        hideLoading();
        showPopup("L·ªói k·∫øt n·ªëi: "+err.message, true);
    });
});

historyUpdateBtn.addEventListener("click", () => {
    const record = historyRecords[currentHistoryIndex];
    
    const newLesson = document.getElementById('history-edit-lesson').value.trim();
    const newTitle = document.getElementById('history-edit-title').value.trim();
    const newComment = document.getElementById('history-edit-comment').value.trim();
    const newRating = document.getElementById('history-edit-rating').value;

    if(!newLesson || !newTitle) {
        showPopup("Ti·∫øt v√† T√™n b√†i kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!", true);
        return;
    }

    const payload = { 
        action: "editRecord", 
        sheetName: record.sheetName, 
        rowIndex: record.rowIndex, 
        teacher: record.teacher, 
        lesson: newLesson, 
        title: newTitle,
        comment: newComment,
        rating: newRating
    };
    
    showLoading();
    fetch(WEBAPP_URL, { method:"POST", body: JSON.stringify(payload) })
    .then(r => r.json())
    .then(res => {
        hideLoading();
        if(res.success){
            showPopup(res.message || "C·∫≠p nh·∫≠t th√†nh c√¥ng");
            // C·∫≠p nh·∫≠t b·∫£n ghi trong m·∫£ng local
            record.lesson = newLesson;
            record.title = newTitle;
            record.comment = newComment;
            record.rating = newRating;
            displayCurrentHistoryRecord('view'); // Chuy·ªÉn v·ªÅ mode xem
        } else {
            showPopup("L·ªói: "+(res.message||"C·∫≠p nh·∫≠t th·∫•t b·∫°i"), true);
        }
    })
    .catch(err => {
        hideLoading();
        showPopup("L·ªói k·∫øt n·ªëi: "+err.message, true);
    });
});


function escapeHtml(s) {
  if(s === null || s === undefined) return '';
  return s.toString()
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,"&#39;");
}
function escapeAttr(s) {
  if(s === null || s === undefined) return '';
  return s.toString()
    .replace(/"/g,'&quot;')
    .replace(/'/g,"&#39;");
}

</script>


<footer style="
  background-color: #fff;
  border-top: 1px solid #ddd;
  text-align: center;
  padding: 20px 15px;
  font-size: 14px;
  color: #666;
  box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 25px;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  flex-wrap: wrap;
">
  <i class="fa-regular fa-copyright" style="color:#999; font-size:18px;"></i>
  <span>
    &copy; <span id="year"></span> B·∫£n quy·ªÅn thu·ªôc v·ªÅ 
    <strong style="display:inline-flex; align-items:center; gap:6px;">
      Duy H·∫°nh 
      <i class="fas fa-heart heart-glow" style="font-size:16px; color:#e25555;"></i>
    </strong>.
  </span>

  
  <a href="https://facebook.com/1994duyhanh" target="_blank" style="color:#1877F2; text-decoration:none; display:flex; align-items:center; gap:6px; font-weight:600;">
      <i class="fab fa-facebook-f" style="font-size:18px;"></i> Facebook
  </a>

  <div style="display:flex; align-items:center; gap:6px; color:#333; font-weight:600;">
    <i class="fas fa-phone-alt" style="font-size:18px; color:#4CAF50;"></i>
    <span>0868 640 898</span>
  </div>
</footer>

<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  crossorigin="anonymous"
/>

<style>

/* POPUP CH√ÄO/T·∫†M BI·ªÜT RI√äNG */
.greeting-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fdfdfd; /* M√†u n·ªÅn nh·∫π nh√†ng */
  background: linear-gradient(135deg, #f0fff0, #e6f7ff); /* Gradient ƒë·∫πp m·∫Øt */
  padding: 40px 50px;
  border-radius: 20px;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); /* ƒê·ªï b√≥ng s√¢u h∆°n */
  text-align: center;
  z-index: 7000;
  max-width: 90%;
  min-width: 300px;
  border: 2px solid #2ecc71; /* Vi·ªÅn n·ªïi b·∫≠t */
  animation: fadeIn 0.8s ease-out; /* Animation m∆∞·ª£t m√† h∆°n */
}

.greeting-message {
  font-size: 1.8rem; /* K√≠ch th∆∞·ªõc l·ªõn h∆°n */
  color: #2c3e50; /* M√†u ch·ªØ ƒë·∫≠m */
  margin-bottom: 12px;
  font-weight: 700;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.05); /* Text-shadow nh·∫π */
}

.greeting-subtext {
  font-size: 1rem;
  color: #7f8c8d; /* M√†u ch·ªØ ph·ª• */
  font-weight: 500;
  line-height: 1.5;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translate(-50%, -40%); }
  to { opacity: 1; transform: translate(-50%, -50%); }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}
  /* Hi·ªáu ·ª©ng glow nh·∫π cho icon tr√°i tim */
  .heart-glow {
    animation: glowHeart 2s ease-in-out infinite alternate;
  }

  @keyframes glowHeart {
    0% {
      text-shadow:
        0 0 5px #e25555,
        0 0 10px #e25555,
        0 0 15px #ff4b4b;
      transform: scale(1);
    }
    100% {
      text-shadow:
        0 0 15px #ff4b4b,
        0 0 25px #ff4b4b,
        0 0 35px #ff6f6f;
      transform: scale(1.1);
    }
  }
</style>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();
</script>



<div id="greeting-popup" class="greeting-popup" style="display:none;">
  <div class="greeting-message" id="greeting-text"></div>
  <div class="greeting-subtext" id="greeting-subtext"></div>
</div>

// H√†m ƒë·ªÉ l·∫•y v·ªã tr√≠ c·ªßa ng∆∞·ªùi d√πng
    function getUserLocation() {
        if (navigator.geolocation) {
            // Y√™u c·∫ßu tr√¨nh duy·ªát l·∫•y v·ªã tr√≠
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    // Th√†nh c√¥ng: L·∫•y ƒë∆∞·ª£c v·ªã tr√≠
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    console.log("Vƒ© ƒë·ªô: " + latitude);
                    console.log("Kinh ƒë·ªô: " + longitude);
                    
                    // B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng latitude v√† longitude ·ªü ƒë√¢y
                    // V√≠ d·ª•: hi·ªÉn th·ªã l√™n m·ªôt √¥ input ho·∫∑c g·ª≠i ƒëi
                },
                function(error) {
                    // Th·∫•t b·∫°i: Ng∆∞·ªùi d√πng t·ª´ ch·ªëi ho·∫∑c c√≥ l·ªói
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            console.error("Ng∆∞·ªùi d√πng ƒë√£ t·ª´ ch·ªëi y√™u c·∫ßu v·ªã tr√≠.");
                            alert("B·∫°n ƒë√£ t·ª´ ch·ªëi c·∫•p quy·ªÅn truy c·∫≠p v·ªã tr√≠.");
                            break;
                        case error.POSITION_UNAVAILABLE:
                            console.error("Th√¥ng tin v·ªã tr√≠ kh√¥ng kh·∫£ d·ª•ng.");
                            alert("Kh√¥ng th·ªÉ l·∫•y ƒë∆∞·ª£c v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·∫°n.");
                            break;
                        case error.TIMEOUT:
                            console.error("Y√™u c·∫ßu l·∫•y v·ªã tr√≠ ƒë√£ h·∫øt th·ªùi gian.");
                            alert("Y√™u c·∫ßu l·∫•y v·ªã tr√≠ ƒë√£ h·∫øt th·ªùi gian.");
                            break;
                        default:
                            console.error("M·ªôt l·ªói kh√¥ng x√°c ƒë·ªãnh ƒë√£ x·∫£y ra.");
                            alert("ƒê√£ x·∫£y ra l·ªói khi l·∫•y v·ªã tr√≠.");
                            break;
                    }
                }
            );
        } else {
            // Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Geolocation
            alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ l·∫•y v·ªã tr√≠.");
        }
    }

    // T·ª± ƒë·ªông g·ªçi h√†m getUserLocation() khi trang web ƒë∆∞·ª£c t·∫£i
    window.onload = function() {
        getUserLocation();
    };



</body>

</html>

